"use strict";exports.__esModule=!0,exports._xEnvConfig=_xEnvConfig,exports.executeTypeOptions=exports.envFilePropConsistency=exports.dotEnvConfig=void 0,exports.makeEnvFormat=makeEnvFormat,exports.projectRoot=exports.processArgs=exports.pathToBaseRootEnv=exports.matchEnv=void 0,exports.readENV=readENV;var _readEnvFile=require("read-env-file"),_path=_interopRequireDefault(require("path")),_data=require("./data"),_dotenv=require("dotenv"),_umd=require("x-utils-es/umd"),_os=require("os");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var dotEnvConfig=function dotEnvConfig(pth,_debug){if(void 0===_debug&&(_debug=!1),!!pth)try{return(0,_dotenv.config)({path:pth})}catch(err){_debug&&(0,_umd.onerror)("[XEnv][dotEnvConfig]",err.toString())}};exports.dotEnvConfig=dotEnvConfig;var envFilePropConsistency=function envFilePropConsistency(list){var propCheck=function propCheck(envKeys,all){for(var pass=0,_loop=function _loop(inx){var each=all[inx];envKeys.filter(function(x){return each.filter(function(y){return x===y}).length}).length===envKeys.length&&pass++},inx=0;inx<all.length;inx++)_loop(inx);return all.length===pass};return list.filter(function(env,inx,all){return propCheck(Object.keys(env),all.map(function(x){return Object.keys(x)}))}).length===list.length};exports.envFilePropConsistency=envFilePropConsistency;var processArgs=function processArgs(_args,regExp){return _args.reduce(function(n,val){var mch=val.match(regExp);return mch&&(n[mch[1]]=mch[2]),n},{})};exports.processArgs=processArgs;var projectRoot=function projectRoot(envPath){return"~"===(envPath||"")[0]?_path["default"].join((0,_os.homedir)(),(envPath||"").slice(1)):envPath||""};exports.projectRoot=projectRoot;function _xEnvConfig(argv,regExp){void 0===regExp&&(regExp=_data.regExp_path);var args=processArgs(argv,regExp);if(args.path){var pth=_path["default"].isAbsolute(args.path)?args.path:_path["default"].resolve(process.cwd(),args.path);args.path=pth}return Object.assign({},args,{})}var matchEnv=function matchEnv(NODE_ENV){return NODE_ENV?Object.entries(_data.ENV_NAME_CONVENTIONS).reduce(function(n,_ref){var k=_ref[0],val=_ref[1];if(!n){val.filter(function(x){return x===NODE_ENV}).length&&(n=k)}return n},""):void 0};exports.matchEnv=matchEnv;var executeTypeOptions=function executeTypeOptions(execType){return["CLI"===execType?"CLI":null,"ROBUST"===execType?"ROBUST":null].filter(function(n){return!!n})};exports.executeTypeOptions=executeTypeOptions;var pathToBaseRootEnv=function pathToBaseRootEnv(pth){return void 0===pth&&(pth=""),pth=pth||_path["default"].resolve(process.cwd(),".env"),_path["default"].isAbsolute(pth)?pth:_path["default"].resolve(process.cwd(),pth)};exports.pathToBaseRootEnv=pathToBaseRootEnv;function readENV(envRootFilePath,debug){void 0===debug&&(debug=!1),envRootFilePath=pathToBaseRootEnv(envRootFilePath);try{return _readEnvFile.readSingle.sync(envRootFilePath)}catch(err){debug&&console.error(err.toString())}return{}}function makeEnvFormat(parsed,msg){if(parsed&&parsed){var prepend=msg,envData=Object.entries(parsed||{}).reduce(function(n,_ref2){var k=_ref2[0],val=_ref2[1];return void 0!==parsed[k]&&(n=n?n+(k+"="+val.toString()+"\n"):k+"="+val.toString()+"\n"),n},"");return envData?envData?prepend?"# "+prepend+"\n"+envData:envData:envData:void 0}}